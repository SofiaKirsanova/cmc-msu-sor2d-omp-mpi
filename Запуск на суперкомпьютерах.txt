Сайт курса: http://hpc.cmc.msu.ru/

Предполагается, что на данном этапе Вы уже создали ключи, отправили преподавателю, он переправил их 
техподдержке, а те в свою очередь дали Вам доступ на суперкомпы ВМК.

OMP:
Компиляция локально: gcc -Wall -o filename filename.c -fopenmp
Затем просмотр результатов: ./filename


Порядок запуска на polus: (взято с лекций)
1. ssh -i edu-cmc-skpod**-3**-** edu-cmc-skpod**-3**-**@polus.cs.msu.ru
    Пример: ssh -i edu-cmc-skpod21-320-10 edu-cmc-skpod21-320-10@polus.cs.msu.ru, где:
        21 - текущий год
        320 - группа
        10 - Ваш номер в группе

2. Вводим пароль. Тот, который Вы вбили при первом подключении к серверу (т.е. когда первый раз вбили команду из п.1)
    Если это Ваш первый раз, то придумайте пароль (ключ на этот момент уже должен быть!)

3. Создать файл, куда вставить код своей программы. Можно назвать также, как и локальном компе
    1) vim filename.c
    В vim: жмякать I на клавиатуре, внизу видите INSERT => Ctrl+V сюда => ESC => пишите команду сохранения ":wq!"
    Без кавычек, конечно же.
    Это общая схема создания файлов через терминал.
    
    2) Проверяете, создали ли файл
        ls 
    Если файл есть, то Вы молодец

4. Компиляция
    xlc -qsmp=omp "название программы (т.е. того файла, в который вставили код на предыдущем шаге) с расширением .c"
    Пример: xlc -qsmp=omp filename.c

5. Создание файла с очередью (аналогично пункту 3). 
    В этом файле Вы пишите на скольки потоках (нитях) будете запускать прогу. 
    Напрмер, я запускаю на 1, 2, 4, 8, 16, 32 и 64 нитях. a.out - мой выходной файл
    КОПИРУЙТЕ И ВСТАВЛЯЙТЕ СЕБЕ, ТОЛЬКО ЗАМЕНИВ ЧИСЛО НИТЕЙ ПРИ НЕОБХОДИМОСТИ или по желанию

    Файл queue:

            # LSBATCH: User input
            # this file was automaticly created by mpisubmit.pl script for edu-cmc-skpod21-320-10 #
            source /polusfs/setenv/setup.SMPI
            #BSUB -n 1
            #BSUB -W 00:15
            #BSUB -o a.out.%J.out
            #BSUB -e a.out.%J.err
            OMP_NUM_THREADS=1 mpiexec ./a.out
            OMP_NUM_THREADS=2 mpiexec ./a.out
            OMP_NUM_THREADS=4 mpiexec ./a.out
            OMP_NUM_THREADS=8 mpiexec ./a.out
            OMP_NUM_THREADS=16 mpiexec ./a.out
            OMP_NUM_THREADS=32 mpiexec ./a.out
            OMP_NUM_THREADS=64 mpiexec ./a.out

6. Запуск кода на суперкомпе
    bsub < "название файла очереди без расширения"
    Например: bsub < queue
    Строка "Job <123456> is submitted to default queue <short>" => код запущен в работу на суперкомпе, все хорошо

7. Проверка работы Вашей проги на Полюсе
    bjobs
    "No unfinished job found" => Ваш код закончил работать, можно проверять результаты

8. Открываете выходной файл, чтобы численные данные вставить в отчет и построить по ним графики.
    cat "название выходного файла вида: a.out.123456.out"
    Например: cat a.out.123456.out
    Если у Вас нет никаких выводов, значит Вы ничего не печатаете в своей программе
    Из этого файлика берете чиселки для отчета


MPI:
Компиляция локально: mpicc -o sor_2d_mpi sor_2d_mpi.c
    Предварительно сделав: 
                            sudo apt-get install libcr-dev mpich2 mpich2-doc

Затем просмотр результатов: mpiexec -np 4 ./sor_2d_mpi
Если у Вас в коде подчеркнута строка #include <mpi.h>, то это ничего страшного. Игнорируйте

Порядок запуска на BlueGene:
1. Заходим на сервер:
    ssh -i edu-cmc-skpod**-3**-** edu-cmc-skpod**-3**-**@polus.cs.msu.ru
    Пример: ssh -i edu-cmc-skpod21-320-10 edu-cmc-skpod21-320-10@bluegene.cs.msu.ru, где:
        21 - текущий год
        320 - группа
        10 - Ваш номер в группе

2. Вводим пароль. Тот, который Вы вбили при первом подключении к серверу (т.е. когда первый раз вбили коменду из п.1)
    Если это Ваш первый раз, то придумайте пароль. Для BlueGene и Polus пароли одинаковые

3. Создать файл, куда вставить код своей программы. Можно назвать также, как и локальном компе
    1) vim filename.c
    В vim: жмякнуть I на клавиатуре, внизу видите INSERT => Ctrl+V сюда => ESC => пишите команду сохранения ":wq!"
    Без кавычек, конечно же
    
    2) Проверяете, создали ли файл
    ls 
    Если файл есть, то Вы молодец

4. Компиляция
    mpixlc_r -qsmp=omp filename.c -o filename

    Пусть Вас не смущает, что -qsmp=omp. Это норм, это все равно MPI. -qsmp=mpi все равно сделать нельзя

5. Запуск и постановка в очередь
    mpisubmit.bg -n 128 -w 00:15:00 -m dual -e "OMP_NUM_THREADS=N" filename

    N количество нитей 
    filename имя запускаемого файла (без расширения!)

    Я не умею создавать командные файлы, все запускала руками по 10 раз. 
    Подробно про их создание на BlueGene на сайте курса: http://hpc.cmc.msu.ru/bgp/jobs/jcf

6. Проверка работы Вашей проги на BlueGene
    llq

7. Открываете выходной файл, чтобы численные данные вставить в отчет и построить по ним графики.
    cat "название выходного файла вида: a.out.123456.out"
    Например: cat a.out.123456.out
    Если у Вас нет никаких выводов, значит Вы ничего не печатаете в своей программе